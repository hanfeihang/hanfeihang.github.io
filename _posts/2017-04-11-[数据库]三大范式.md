---
layout: post
title: '数据库三大范式'
date: 2017-04-11
author: Feihang Han
tags: 数据库
---

为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种规则就称为范式。范式是符合某一种设计要求的总结。要想设计一个结构合理的关系型数据库，必须满足一定的范式。在实际开发中最为常见的设计范式有以下三种。

# 1NF

第一范式确保每列的原子性。

即数据库表的每一列都是不可分割的原子数据项，而不能是集合，数组，记录等非原子数据项。即实体中的某个属性有多个值时，必须拆分为不同的属性。

客户表

| 编号 | 姓名 | 地址 |
| :--- | :--- | :--- |
| 1 | 张三 | 浙江杭州滨江区xx路 |
| 2 | 李四 | 浙江杭州西湖区xx路 |

上述表中，地址信息非原子性，不符合第一范式的要求，可以改造成如下表。

| 编号 | 姓名 | 省份 | 市区 | 详细地址 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | 张三 | 浙江 | 杭州 | 滨江区xx路 |
| 2 | 李四 | 浙江 | 杭州 | 西湖区xx路 |

改造后的客户表遵循了第一范式的要求，将用户地址拆分成省份、市区、详细地址三个字段，这样在对用户使用城市进行分类的时候就非常方便，也提高了数据库的性能。

# 2NF

在满足第一范式的基础上，第二范式确保数据库表中的每一列都和主键相关。

也就是说在一个数据库表中，一个表中只能保存一种数据，不可以把多种数据保存在同一张数据库表中。

| 订单编号 | 订单日期 | 商品编号 | 商品名称 | 数量 | 单价 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 001 | 2017-4-11 | 1 | 《相对论》 | 2 | 60 |
| 001 | 2017-4-11 | 2 | 《果壳中的宇宙》 | 1 | 50 |
| 002 | 2017-4-12 | 3 | 巧克力 | 10 | 5 |

如上订单信息表，将订单编号和商品编号作为数据库表的联合主键。但是该表中商品名称仅仅与商品编号相关，订单日期仅仅与订单编号相关，所以在这里违反了第二范式的设计原则。如果把这个订单信息表进行如下拆分，就满足第二范式了。

商品表

| 商品编号 | 商品名称 | 单价 |
| :--- | :--- | :--- |
| 1 | 《相对论》 | 60 |
| 2 | 《果壳中的宇宙》 | 50 |
| 3 | 巧克力 | 5 |

订单表

| 订单编号 | 订单时间 |
| :--- | :--- |
| 001 | 2017-4-11 |
| 002 | 2017-4-12 |

拆分后，变成了两张独立的表：商品表和订单表。然后通过以下这种订单商品关联表进行关联。

订单商品关联表

| 订单编号 | 商品编号 | 数量 |
| :--- | :--- | :--- |
| 001 | 1 | 2 |
| 001 | 2 | 1 |
| 002 | 3 | 10 |

# 3NF

在满足第二范式的基础上，第三范式确保数据表中的每一列数据都和主键直接相关，而不能间接相关。

比如在上述订单表中增加客户信息，变成如下订单表。

| 订单编号 | 订单时间 | 客户编号 | 客户名字 |
| :--- | :--- | :--- | :--- |
| 001 | 2017-4-11 | 1 | 张三 |
| 002 | 2017-4-12 | 2 | 李四 |

但是仔细分析可以知道，客户名字与客户编号直接相关，客户编号与订单编号直接相关，而客户名字与订单编号间接相关。因此需要将客户名字该列从表中去掉。改造后的表如下。

| 订单编号 | 订单时间 | 客户编号 |
| :--- | :--- | :--- |
| 001 | 2017-4-11 | 1 |
| 002 | 2017-4-12 | 2 |

这样程序可以通过外键——客户编号进行客户信息的查询。

# 总结

在实际的数据库设计中，我们不能一味的追求规范化，既要考虑三大范式，减少数据冗余和各种数据库操作异常，又要充分考虑到数据库的性能问题，允许适当的数据库冗余。



