---
layout: post
title: 'MySQL存储引擎'
date: 2017-07-26
author: Feihang Han
cover: 'http://on2171g4d.bkt.clouddn.com/jekyll-banner.png'
tags: MySQL
---


#### MySQL组件

MySQL由以下几部分组成：

* 连接池
* 管理服务和工具
* SQL接口
* 查询分析器
* 优化器
* 缓冲
* 插件式存储引擎
* 物理文件

MySQL区别与其他数据库的最重要的特点就是其插件式的表存储引擎。该插件式的存储引擎架构提供了一系列标准的管理和服务支持，这些标准与存储引擎本身无关，可能是每个数据库系统本身都必需的，如SQL分析器和优化器等，而存储引擎是底层物理结构的实现，每个存储引擎开发者都可以按自己的意愿来进行开发。

存储引擎的好处是，每个存储引擎都有各自的特点，能够根据具体的应用建立不同的存储引擎表。以下是一些存储引擎的简介。

#### InnoDB存储引擎

InnoDB存储引擎支持事务，主要面向在线事务处理（OLTP）方面的应用。其特点是行锁设计、支持外键，并支持类似于Oracle的非锁定读，即默认情况下读取操作不会产生锁。

InnoDB通过使用多版本并发控制（MVCC）来获取高并发性，并且实现了SQL标准的4种隔离级别，默认为REPEATABLE级别。同时使用next-key locking的策略来避免幻读现象的产生。除此以外，InnoDB存储引擎还提供了插入缓冲、二次写、自适应哈希索引、预读等高性能和高可用的功能。

对于表中数据的存储，InnoDB存储引擎采用了聚集（clustered）的方式，这种方式类似于Oracle的索引聚集表。每张表的存储都按主键的顺序存放，如果没有显示的在表定义时指定主键，InnoDB存储引擎会为每一行生成一个6字节的ROWID，并以此作为主键。

#### MyISAM存储引擎

MyISAM存储引擎是MySQL官方提供的存储引擎。其特点是不支持事务、表锁和全文索引，对于一些OLAP（Online Analytical Processing，在线分析处理）操作速度快。

MyISAM存储引擎表由MYD和MYI组成，MYD用来存放数据文件，MYI用来存放索引文件。

对于MyISAM存储引擎表，MySQL数据库只缓存其索引文件，数据文件的缓存交由操作系统本身来完成。

#### NDB存储引擎

NDB存储引擎是一个集群存储引擎，类似于Oracle的RAC集群；不过，与Oracle RAC share everything结构不同的是，其结构是share nothing的集群架构，因此能提供更好级别的高可用性。NDB的特点是数据全部放在内存中（从5.1版本开始，可以将非索引数据放在磁盘上），因此主键查找的速度极快，并且通过添加NDB数据存储节点（Data Node）可以线性地提高数据库性能，是高可用、高性能的集群系统。

注意，NDB存储引擎的连接操作（JOIN）是在MySQL数据库层完成的，而不是在存储引擎层完成的。这意味着，复杂的连接操作需要巨大的网络开销，因此查询速度很慢。如果解决了这个问题，NDB存储引擎的市场应该是非常巨大的。

#### Memory存储引擎

Memory存储引擎（之前成为HEAP存储引擎）将表中的数据存放在内存中，如果数据库重启或发生奔溃，表中的数据都将消失。它非常适合用于存储临时数据的临时表，以及数据仓库中的维度表。它默认使用哈希索引，而不是我们熟悉的B+树索引。

虽然Memory存储引擎速度非常快，但在使用上还是有一定的限制。比如，其只支持表锁，并发性能较差，并且不支持TEXT和BLOB列类型。最重要的是，存储变长字段（varchar）时是按照定长字段（char）的方式进行的，因此会浪费内存。此外有一点常被忽视的是，MySQL数据库使用Memory存储引擎作为临时表来存放查询的中间结果集（intermediate result）。如果中间结果集大于Memory存储引擎表的容量设置，又或者中间结果含有TEXT或BLOB列类型的字段，则MySQL数据库会把其转换到MyISAM存储引擎表而存放磁盘。之前提到MyISAM不缓存数据文件，因此这时产生的临时表的性能对于查询会有损失。

#### Archive存储引擎

Archive存储引擎只支持INSERT和SELECT操作，MySQL5.1开始支持索引。其使用zlib算法将数据行进行压缩后存储，压缩比率一般可达1:10。正如其名称所示，Archive存储引擎非常适合存储归档数据，如日志信息。Archive存储引擎使用行锁来实现高并发的插入操作，但是本身并不是事务安全的存储引擎，其设计目标主要是提供高速的插入和压缩功能。

#### Federated存储引擎

Federated存储引擎表并不存放数据，它只是指向一台远程MySQL数据库服务器上的表。这非常类似于SQL Server的链接服务器和Oracle的透明网关，不同的是，当前Federated存储引擎只支持MySQL数据库表，不支持异构数据库表。

#### Maria存储引擎

Maria存储引擎是新开发的引擎，设计目标主要是用来取代原有的MyISAM存储引擎，从而成为MySQL的默认存储引擎，开发者是MySQL的创始人之一的Michael Widenius。因此，它可以看做是MyISAM的后续版本。其特点是：缓存数据和索引文件，行锁设计，提供MVCC功能，支持事务和非事务安全的选项支持，以及更好的BLOB字符类型的处理性能。

#### 其他引擎

除了以上几种存储引擎外，还有很多其他的存储引擎，包括Merge、CSV、Sphinx和Infobright，它们有各自适用的场景。

#### 一些问题

> * 为什么MySQL不支持全文索引？
>
> 不，MySQL的MyISAM、Sphinx存储引擎支持全文索引。
>
> * MySQL快是因为不支持事务吗？
>
> 不，MySQL MyISAM存储引擎不支持事务，但是InnoDB支持。
>
> * 当表的数据量大于1000W时，MySQL性能会急剧下降吗？
>
> 不，MySQL数据库随着数据行数的增加，性能当然会有所下降，但是这些下降不是线性的，如果你选择了正确的存储引擎以及正确的配置，再大的数据量MySQL也是能承受的。



